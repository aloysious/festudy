# 淘金币活动页v2.0版本

## 目录结构
glodcoin/2.0
    |--build.xml
    |--glodcoin.css
	|--glodcoin.shtml
	|--dialog-demo.shtml
	|--data
	|--header
	|--introdution
	|--lottery
	|--moreactivities
	|--popupwindow

* build.xml为项目构建和编译发布的脚本文件；
* glodcoin.css为页面的样式文件；
* glodcoin.shtml为本地开发和调试的demo页面；
* dialog-demo.shtml为各种弹框的demo页面；
* data目录存放本地开发用到的接口假数据；
* header、introdution、lottery、moreactivities、popupwindow为组成页面的5个模块，个目录下分别存放模块的js文件和html文件。

## 新款游戏活动页面开发流程

当有新款游戏的开发需求时，可以基于2.0版本的结构进行扩展开发。原则是保持业务逻辑（js部分）保持不变，主要调整样式文件。

1. 在tms中创建新区块，区块源代码参见XXXX。每款游戏的tms代码绝大部分保持一致，有几处需要修改的地方：SNS分享弹框控件的配置参数；抽奖动态url生成函数的输入参数（ruleId、keyCode）； 游戏简介flash的引用url地址。

2. 为每款游戏重写一份样式文件，参见glodcoin.css，需要定制页面背景图片、弹框背景图片，同时调整页面中各按钮的定位。可参考glodcoin.shtml和dialog-demo.shtml在本地进行快速的样式开发和调试。提交样式文件。

3. 在tms中修改样式文件引用地址，进行预览和发布。告知后端开发包裹区块，生成活动页的链接地址。

4. 在daily环境中进行自测回归。提测、上线。

## 项目总结

### 关于项目目录结构
* 基于kissy的模块化开发，git进行版本管理，可自动化抽取模块依赖关系、自动化同步svn和发布。
* 由于项目只涉及一个页面，所以并没有对文件进行复杂的目录划分，现在看来这个项目比较适合把js、css、demo分开存放，以后有新需求则只需扩展css和demo目录。
* 目录结构的纵向和横向划分并没有一个绝对的结论，逻辑和页面结构固定而需要量产化的项目比较适合纵向划分（js、css、demo），而逻辑和页面结构扩展频繁的项目比较适合横向划分（pages、mods、widgets）。

### 关于代码重构
* v1.0版本把所有的逻辑和样式都写在tms中，而且接口调用全部写死，这样很不方便于本地和日常环境的调试。tms开发切记做到逻辑、样式和页面的分离。
* v2.0版本开发的一部分人力成本就是重构js代码，把逻辑从页面抽离，按照功能点对页面进行模块划分，并把逻辑打散到每一个模块内部。新需求扩展了很多弹框逻辑和样式，为此把与弹框相关的逻辑封装成popupwindow模块，好处是便于管理和定位，坏处是增加了模块间的通信成本。考虑到每一款游戏页面的样式定制程度高，并没有对css文件进行拆分，每款游戏只需新建一份类似的样式文件即可。

### 关于兼容性
这个项目在测试阶段修兼容性问题也耗费了不少精力，主要的兼容性问题罗列如下：
* 背景透明的png图在ie6下无法显示透明，可以在css加filter实现透明。ie7不存在这个问题。
* kissy的dialog组件若针对窗体的中心进行定位，在ie6下每一个show之前都需要重新定位，否则dialog会置到页面顶部。
* dialog组件的bodyContent加了padding在ie6下出现黑屏的问题。
* 异步接口不加时间戳，ie默认模式下返回304，chrome下返回200。加时间戳为好。
* 乱码问题。做到页面编码、静态文件编码、服务器默认编码三者统一。

对于ie6的兼容性问题，还是希望逐步建立知识库，甚至从中抽取出规则，实习自动化检测，这样QA和我们的工作压力都可以减轻，找紫树商讨。

### 关于淘金币活动页产品化
* 如果新需求逐渐增多，现在的页面设计和开发模式是不适合产品化的，每款游戏前端切页面和调样式的预估工作量为3人/天。
* 要快速响应需求，可考虑页面样式提高统一化，允许局部的个性化定制。
